// HS Code Database for Pakistan - Common Tax Consultancy and Business Items
const hsCodeDatabase = {
  // Tax Consultancy Services
  "tax consultation": "9983.11.00",
  "tax filing": "9983.11.00",
  "tax planning": "9983.11.00",
  "tax compliance": "9983.11.00",
  "tax audit": "9983.11.00",
  "tax advisory": "9983.11.00",
  "consultation": "9983.11.00",
  "advisory": "9983.11.00",
  
  // Registration Services
  "ntn registration": "9983.12.00",
  "strn registration": "9983.12.00",
  "business registration": "9983.12.00",
  "company registration": "9983.12.00",
  "registration": "9983.12.00",
  
  // Accounting Services
  "accounting": "9983.13.00",
  "bookkeeping": "9983.13.00",
  "financial statements": "9983.13.00",
  "audit": "9983.13.00",
  "auditing": "9983.13.00",
  
  // Legal Services
  "legal consultation": "9983.14.00",
  "legal advice": "9983.14.00",
  "legal services": "9983.14.00",
  "legal": "9983.14.00",
  
  // Software and IT Services
  "software": "9983.15.00",
  "software development": "9983.15.00",
  "it services": "9983.15.00",
  "web development": "9983.15.00",
  "app development": "9983.15.00",
  "digital services": "9983.15.00",
  
  // Training and Education
  "training": "9983.16.00",
  "education": "9983.16.00",
  "workshop": "9983.16.00",
  "seminar": "9983.16.00",
  "course": "9983.16.00",
  
  // Marketing and Advertising
  "marketing": "9983.17.00",
  "advertising": "9983.17.00",
  "promotion": "9983.17.00",
  "branding": "9983.17.00",
  
  // Transportation and Logistics
  "transportation": "9983.18.00",
  "logistics": "9983.18.00",
  "shipping": "9983.18.00",
  "delivery": "9983.18.00",
  "freight": "9983.18.00",
  
  // Construction and Real Estate
  "construction": "9983.19.00",
  "real estate": "9983.19.00",
  "property": "9983.19.00",
  "building": "9983.19.00",
  
  // Manufacturing and Industrial
  "manufacturing": "9983.20.00",
  "industrial": "9983.20.00",
  "production": "9983.20.00",
  "factory": "9983.20.00",
  
  // Retail and Wholesale
  "retail": "9983.21.00",
  "wholesale": "9983.21.00",
  "trading": "9983.21.00",
  "commerce": "9983.21.00",
  
  // Healthcare and Medical
  "healthcare": "9983.22.00",
  "medical": "9983.22.00",
  "health": "9983.22.00",
  "pharmaceutical": "9983.22.00",
  
  // Food and Beverage
  "food": "9983.23.00",
  "beverage": "9983.23.00",
  "restaurant": "9983.23.00",
  "catering": "9983.23.00",
  
  // Textile and Clothing
  "textile": "9983.24.00",
  "clothing": "9983.24.00",
  "garment": "9983.24.00",
  "fabric": "9983.24.00",
  
  // Electronics and Technology
  "electronics": "9983.25.00",
  "technology": "9983.25.00",
  "computer": "9983.25.00",
  "mobile": "9983.25.00",
  "phone": "9983.25.00",
  
  // Automotive and Vehicles
  "automotive": "9983.26.00",
  "vehicle": "9983.26.00",
  "car": "9983.26.00",
  "motorcycle": "9983.26.00",
  
  // Agriculture and Farming
  "agriculture": "9983.27.00",
  "farming": "9983.27.00",
  "crop": "9983.27.00",
  "livestock": "9983.27.00",
  
  // Poultry Products
  "poultry": "2309.00.00",
  "poultry meal": "2309.00.00",
  "poultry oil": "1511.00.00",
  "chicken meal": "2309.00.00",
  "chicken oil": "1511.00.00",
  "bird meal": "2309.00.00",
  "bird oil": "1511.00.00",
  "feed meal": "2309.00.00",
  "animal feed": "2309.00.00",
  "poultry feed": "2309.00.00",
  "chicken feed": "2309.00.00",
  "bird feed": "2309.00.00",
  "meal": "2309.00.00",
  "oil": "1511.00.00",
  
  // Energy and Utilities
  "energy": "9983.28.00",
  "electricity": "9983.28.00",
  "gas": "9983.28.00",
  "utility": "9983.28.00",
  
  // Banking and Finance
  "banking": "9983.29.00",
  "finance": "9983.29.00",
  "financial": "9983.29.00",
  "investment": "9983.29.00",
  
  // Insurance
  "insurance": "9983.30.00",
  "assurance": "9983.30.00",
  "coverage": "9983.30.00",
  
  // Telecommunications
  "telecommunication": "9983.31.00",
  "telecom": "9983.31.00",
  "communication": "9983.31.00",
  "internet": "9983.31.00",
  
  // Entertainment and Media
  "entertainment": "9983.32.00",
  "media": "9983.32.00",
  "broadcasting": "9983.32.00",
  "publishing": "9983.32.00",
  
  // Tourism and Travel
  "tourism": "9983.33.00",
  "travel": "9983.33.00",
  "hotel": "9983.33.00",
  "accommodation": "9983.33.00",
  
  // Environmental Services
  "environmental": "9983.34.00",
  "waste": "9983.34.00",
  "recycling": "9983.34.00",
  "pollution": "9983.34.00",
  
  // Security Services
  "security": "9983.35.00",
  "guarding": "9983.35.00",
  "protection": "9983.35.00",
  "surveillance": "9983.35.00",
  
  // Cleaning and Maintenance
  "cleaning": "9983.36.00",
  "maintenance": "9983.36.00",
  "repair": "9983.36.00",
  "servicing": "9983.36.00",
  
  // Research and Development
  "research": "9983.37.00",
  "development": "9983.37.00",
  "r&d": "9983.37.00",
  "innovation": "9983.37.00",
  
  // Consulting Services
  "consulting": "9983.38.00",
  "consultant": "9983.38.00",
  "expertise": "9983.38.00",
  "specialist": "9983.38.00",
  
  // Default for unknown items
  "default": "9983.99.00"
};

// Function to find HS code based on description
function findHSCode(description) {
  if (!description) {
    return "9983.99.00"; // Default HS code
  }
  
  const searchText = description.toLowerCase().trim();
  
  // Direct match
  if (hsCodeDatabase[searchText]) {
    return hsCodeDatabase[searchText];
  }
  
  // Partial match - find the best match
  let bestMatch = null;
  let bestScore = 0;
  
  for (const [key, hsCode] of Object.entries(hsCodeDatabase)) {
    if (key === "default") continue; // Skip default
    
    // Check if description contains the key
    if (searchText.includes(key)) {
      const score = key.length; // Longer matches get higher scores
      if (score > bestScore) {
        bestScore = score;
        bestMatch = hsCode;
      }
    }
    
    // Check if key contains the description (for shorter descriptions)
    if (key.includes(searchText)) {
      const score = searchText.length;
      if (score > bestScore) {
        bestScore = score;
        bestMatch = hsCode;
      }
    }
  }
  
  return bestMatch || hsCodeDatabase["default"];
}

// Function to get multiple suggestions for a description
function getHSCodeSuggestions(description, limit = 5) {
  if (!description) {
    return [hsCodeDatabase["default"]];
  }
  
  const searchText = description.toLowerCase().trim();
  const suggestions = [];
  
  for (const [key, hsCode] of Object.entries(hsCodeDatabase)) {
    if (key === "default") continue;
    
    if (searchText.includes(key) || key.includes(searchText)) {
      suggestions.push({
        description: key,
        hsCode: hsCode,
        relevance: key.length
      });
    }
  }
  
  // Sort by relevance and return top matches
  return suggestions
    .sort((a, b) => b.relevance - a.relevance)
    .slice(0, limit)
    .map(item => ({
      description: item.description,
      hsCode: item.hsCode
    }));
}

// Function to validate HS code format
function validateHSCode(hsCode) {
  if (!hsCode) return false;
  
  // HS code format: XXXX.XX.XX (4 digits, 2 digits, 2 digits)
  const hsCodePattern = /^\d{4}\.\d{2}\.\d{2}$/;
  return hsCodePattern.test(hsCode);
}

// Function to get HS code description
function getHSCodeDescription(hsCode) {
  for (const [key, code] of Object.entries(hsCodeDatabase)) {
    if (code === hsCode) {
      return key;
    }
  }
  return "Unknown HS Code";
}

module.exports = {
  findHSCode,
  getHSCodeSuggestions,
  validateHSCode,
  getHSCodeDescription,
  hsCodeDatabase
}; 